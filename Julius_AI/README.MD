# Julius AI - Agente Conversacional de FinanÃ§as

> Agente de IA conversacional desenvolvido em **Python/FastAPI** que usa **Google Gemini** para processar linguagem natural e criar transaÃ§Ãµes financeiras. Integrado com a API .NET do GestFinancas.

## ğŸ“‹ VisÃ£o Geral

Julius Rock (inspirado no pai do Chris da sÃ©rie "Todo Mundo Odeia o Chris") Ã© um assistente financeiro com personalidade Ãºnica:
- **SarcÃ¡stico e engraÃ§ado** ao comentar gastos
- **PÃ£o-duro por natureza** - sempre critica despesas
- **Inteligente** - detecta valores, categorias e tipos de transaÃ§Ã£o automaticamente
- **Conversacional** - entende linguagem natural em portuguÃªs

## Funcionalidades

-  **Processamento de Linguagem Natural** via Google Gemini
-  **DetecÃ§Ã£o automÃ¡tica** de valores, categorias e tipos
-  **Sistema de confirmaÃ§Ã£o** (draft â†’ confirm/cancel)
-  **IntegraÃ§Ã£o com API .NET** para persistÃªncia
-  **Personalidade Ãºnica** com respostas humorÃ­sticas
-  **API REST FastAPI** para comunicaÃ§Ã£o com frontend
-  **CORS configurÃ¡vel** para mÃºltiplas origens

##  InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### PrÃ©-requisitos

- **Python 3.10+** ([Download](https://python.org))
- **Google Gemini API Key** ([Obter aqui](https://makersuite.google.com/app/apikey))
- **API .NET** rodando em `https://localhost:7022`

### InstalaÃ§Ã£o

1. **Navegue atÃ© o diretÃ³rio:**
   ```bash
   cd Julius_AI
   ```

2. **Crie ambiente virtual:**
   ```bash
   # Windows
   python -m venv .venv
   .venv\Scripts\Activate.ps1
   
   # Linux/Mac
   python3 -m venv .venv
   source .venv/bin/activate
   ```

3. **Instale dependÃªncias:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Configure variÃ¡veis de ambiente:**
   
   Crie arquivo `.env` na raiz do projeto:
   ```env
   GOOGLE_API_KEY=sua_chave_gemini_aqui
   DOTNET_API_BASE=https://localhost:7022/ai/Transaction
   DB_HOST=localhost
   DB_USER=root
   DB_PASSWORD=sua_senha
   DB_NAME=gestfinancas
   ALLOWED_ORIGINS=http://localhost:4200,http://localhost:3000
   ```

5. **Inicie o servidor:**
   ```bash
   uvicorn main:app --reload --port 8000
   ```

6. **Verifique se estÃ¡ rodando:**
   
   Acesse: `http://localhost:8000/docs` (Swagger UI automÃ¡tico)

## ğŸ“ Estrutura do Projeto

```
Julius_AI/
â”œâ”€â”€ main.py                    # Entrada da aplicaÃ§Ã£o FastAPI
â”œâ”€â”€ requirements.txt           # DependÃªncias Python
â”œâ”€â”€ .env                       # VariÃ¡veis de ambiente (criar)
â”œâ”€â”€ .env.example               # Exemplo de configuraÃ§Ã£o
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ julius_agent.py        # LÃ³gica principal do agente
â”‚   â”œâ”€â”€ memory.py              # Sistema de memÃ³ria (draft)
â”‚   â”œâ”€â”€ parser.py              # Parse de resposta do Gemini
â”‚   â”œâ”€â”€ predictor.py           # PrediÃ§Ãµes (futuro)
â”‚   â”œâ”€â”€ tools.py               # Ferramentas auxiliares
â”‚   â””â”€â”€ transaction.py         # Tipos de transaÃ§Ã£o
â”œâ”€â”€ models/
â”‚   â””â”€â”€ transaction.py         # Modelos Pydantic
â””â”€â”€ services/
    â””â”€â”€ dotnet_client.py       # Cliente HTTP para API .NET
```

## ğŸ”Œ API Endpoints

### `POST /chat`

Envia mensagem para Julius e recebe resposta.

**Request:**
```json
{
  "message": "Gastei R$ 50 no Uber hoje",
  "user_id": "1",
  "token": "opcional_jwt_token"
}
```

**Response:**
```json
{
  "response": "Uber?! De novo? Aprende a andar de Ã´nibus!\n\n Draft criado! Digite CONFIRMAR para salvar ou CANCELAR para desistir."
}
```

##  Como Funciona

### Fluxo de Conversa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UsuÃ¡rio: "Gastei R$ 50 no Uber hoje"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Julius Agent processa com Google Gemini        â”‚
â”‚ - Extrai: valor=50, categoria=Transporte       â”‚
â”‚ - Tipo: Expense                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cria Draft via API .NET                         â”‚
â”‚ POST /ai/Transaction/draft                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Salva em memÃ³ria local (pending_drafts)        â”‚
â”‚ Aguarda "CONFIRMAR" ou "CANCELAR"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UsuÃ¡rio: "CONFIRMAR"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Julius confirma draft via API .NET              â”‚
â”‚ POST /ai/Transaction/confirm/{id}               â”‚
â”‚ (com token JWT do usuÃ¡rio)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Categorias Reconhecidas

- **Transporte** - Uber, tÃ¡xi, gasolina, Ã´nibus
- **AlimentaÃ§Ã£o** - Restaurante, supermercado, delivery
- **Lazer** - Cinema, shows, viagens
- **Outros** - Qualquer outra coisa

### Tipos de TransaÃ§Ã£o

- **Expense** (Despesa) - Gasto
- **Income** (Receita) - Ganho

## ğŸ§© IntegraÃ§Ã£o com API .NET

O Julius se comunica com a API .NET atravÃ©s do cliente HTTP em `services/dotnet_client.py`:

### Criar Draft
```python
POST {DOTNET_API_BASE}/draft
{
  "userId": 1,
  "amount": 50.0,
  "description": "Uber",
  "category": "Transporte",
  "type": "Expense"
}
```

### Confirmar Draft
```python
POST {DOTNET_API_BASE}/confirm/{draft_id}
Headers: {
  "Authorization": "Bearer {token}"
}
```

## ğŸ› ï¸ Desenvolvimento

### Rodar testes
```bash
# Teste rÃ¡pido do modelo
python teste_modelo.py
```

### Debug de Gemini
```bash
# Ver resposta bruta do Gemini
# Adicione prints em julius_agent.py linha ~50
print(f"Resposta Gemini: {raw_response}")
```

### Adicionar nova categoria
Edite `julius_agent.py`:
```python
self.system_prompt = """
CATEGORIA: <Transporte|AlimentaÃ§Ã£o|Lazer|SaÃºde|Outros>
"""
```

## ğŸ” SeguranÃ§a

### PrÃ¡ticas Implementadas
- âœ… CORS configurÃ¡vel via `.env`
- âœ… ValidaÃ§Ã£o de dados com Pydantic
- âœ… Token JWT opcional para operaÃ§Ãµes sensÃ­veis
- âœ… HTTPS na comunicaÃ§Ã£o com API .NET

### Melhorias em Desenvolvimento
- [ ] Rate limiting por usuÃ¡rio
- [ ] ValidaÃ§Ã£o de token JWT no Julius
- [ ] SanitizaÃ§Ã£o de inputs
- [ ] Logging estruturado
- [ ] Monitoramento de uso da API Gemini

## ğŸ§ª Exemplos de Uso

### Testar localmente
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Gastei 100 reais no supermercado",
    "user_id": "1"
  }'
```

### Resposta esperada
```json
{
  "response": "Supermercado de novo?! TÃ¡ comendo ouro?!\n\n Draft criado! Digite CONFIRMAR para salvar."
}
```

### Confirmar
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "CONFIRMAR",
    "user_id": "1",
    "token": "seu_token_jwt"
  }'
```

## ğŸ› Troubleshooting

### Erro: "GOOGLE_API_KEY nÃ£o encontrada"
- Verifique se `.env` existe na raiz do projeto
- Confirme que a chave estÃ¡ correta: [Testar aqui](https://makersuite.google.com/app/apikey)
- Reinicie o servidor apÃ³s adicionar

### Erro: "Connection refused" (API .NET)
- Verifique se a API .NET estÃ¡ rodando
- Confirme URL em `DOTNET_API_BASE` no `.env`
- Se usar HTTPS local, confie no certificado:
  ```bash
  dotnet dev-certs https --trust
  ```

### Julius nÃ£o detecta valores
- Frases devem conter nÃºmeros explÃ­citos: "R$ 50" ou "50 reais"
- Evite abreviaÃ§Ãµes complexas
- Exemplo bom: "Gastei 50 no Uber"
- Exemplo ruim: "Gastei no Uber" (sem valor)

### CORS error no frontend
- Adicione URL do frontend em `ALLOWED_ORIGINS` no `.env`
- Formato: `http://localhost:4200,http://localhost:3000`
- Reinicie o servidor Python

##  DependÃªncias Principais

```txt
fastapi==0.104.1          # Framework web
uvicorn==0.24.0           # Servidor ASGI
google-generativeai==0.3.1 # Cliente Gemini
pydantic==2.5.0           # ValidaÃ§Ã£o de dados
python-dotenv==1.0.0      # VariÃ¡veis de ambiente
requests==2.31.0          # Cliente HTTP
```

##  Roadmap

- [ ] Persistir histÃ³rico de conversas no banco
- [ ] AnÃ¡lise preditiva de gastos (sklearn)
- [ ] Consultas: "Quanto gastei esse mÃªs?"
- [ ] Suporte a mÃºltiplos idiomas
- [ ] CategorizaÃ§Ã£o automÃ¡tica melhorada
- [ ] Webhooks para notificaÃ§Ãµes
- [ ] Dashboard de uso da API Gemini

## ğŸ‘¥ Contribuindo

Consulte o [README principal](../README.md) para guidelines de contribuiÃ§Ã£o.

## ğŸ“„ LicenÃ§a

Projeto educacional - Ver [README principal](../README.md) para mais informaÃ§Ãµes.
